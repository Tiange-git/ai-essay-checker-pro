# 微信小程序部署指南

## 前提条件

1. 微信公众平台账号（已注册小程序）
2. 微信开发者工具
3. 讯飞API账号（用于作文批改功能）

## 部署步骤

### 步骤1：注册小程序

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 完成小程序注册流程
3. 获取AppID

### 步骤2：配置项目

1. 打开 `miniprogram/project.config.json`
2. 将 `appid` 替换为你的小程序AppID
3. 修改 `projectname` 为你的项目名称

### 步骤3：配置云开发环境

1. 打开微信开发者工具
2. 导入 `miniprogram` 项目
3. 点击右上角"云开发"按钮
4. 创建新的云开发环境（记录环境ID）
5. 在 `miniprogram/app.js` 中替换环境ID

### 步骤4：创建数据库集合

1. 进入云开发控制台
2. 打开"数据库"页面
3. 创建以下集合：
   - `history` - 存储批改历史

### 步骤5：配置云函数环境变量

1. 在云开发控制台打开"云函数"页面
2. 为每个云函数配置环境变量：
   - `XUNFEI_APPID`: 讯飞应用ID
   - `XUNFEI_API_KEY`: 讯飞API Key
   - `XUNFEI_API_SECRET`: 讯飞API Secret

### 步骤6：部署云函数

1. 右键点击 `cloudfunctions/checkEssay`
2. 选择"上传并部署：云端安装依赖"
3. 重复部署 `uploadFile` 和 `getHistory` 云函数

### 步骤7：准备Tab Bar图标

1. 在 `miniprogram/images/` 目录添加以下图标：
   - `edit.png` / `edit_active.png`
   - `history.png` / `history_active.png`
2. 尺寸要求：81x81像素

### 步骤8：测试运行

1. 在微信开发者工具中点击"编译"
2. 测试各功能是否正常
3. 查看控制台是否有报错

### 步骤9：上传发布

1. 在微信开发者工具中点击"上传"
2. 填写版本号和备注
3. 提交审核
4. 审核通过后发布

## 讯飞API配置

### 注册讯飞开放平台

1. 访问 [讯飞开放平台](https://www.xfyun.cn/)
2. 注册账号并完成实名认证
3. 创建应用获取API密钥

### 申请API服务

1. 在讯飞开放平台选择"AI能力"->"星火认知大模型"
2. 申请API调用权限
3. 获取AppID、APIKey、APISecret

## 常见问题

### 云函数部署失败

- 检查网络连接
- 确认依赖包版本兼容
- 查看云函数日志

### 数据库权限问题

- 确保集合权限设置为"所有用户可读，仅创建者可读写"
- 或在云函数中使用管理员权限

### API请求超时

- 检查讯飞API配额
- 优化请求内容长度
- 考虑添加重试机制

## 版本历史

### v1.0.0 (2024-01)
- 初始版本
- 支持文本、Word、图片批改
- 历史记录管理
- 云函数部署支持
