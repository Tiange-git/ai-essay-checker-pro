<!--pages/history/history.wxml-->
<view class="container">
  <view class="filter-bar">
    <view 
      class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" 
      bindtap="changeFilter" 
      data-filter="all">
      å…¨éƒ¨
    </view>
    <view 
      class="filter-item {{currentFilter === 'today' ? 'active' : ''}}" 
      bindtap="changeFilter" 
      data-filter="today">
      ä»Šå¤©
    </view>
    <view 
      class="filter-item {{currentFilter === '3days' ? 'active' : ''}}" 
      bindtap="changeFilter" 
      data-filter="3days">
      3å¤©
    </view>
    <view 
      class="filter-item {{currentFilter === 'week' ? 'active' : ''}}" 
      bindtap="changeFilter" 
      data-filter="week">
      ä¸€å‘¨
    </view>
  </view>

  <view class="history-list" wx:if="{{history.length > 0}}">
    <view 
      class="history-item" 
      wx:for="{{history}}" 
      wx:key="id"
      bindtap="selectItem"
      data-item="{{item}}">
      <view class="item-header">
        <view class="item-type">
          <text class="type-icon">{{item.type === 'text' ? 'ğŸ“' : item.type === 'word' ? 'ğŸ“„' : 'ğŸ–¼ï¸'}}</text>
          <text>{{item.type === 'text' ? 'æ–‡æœ¬' : item.type === 'word' ? 'Word' : 'å›¾ç‰‡'}}</text>
        </view>
        <view class="item-actions">
          <text class="item-time">{{formatTime(item.created_at)}}</text>
          <text class="delete-btn" catchtap="deleteItem" data-id="{{item.id}}">Ã—</text>
        </view>
      </view>
      <view class="item-content">
        <text>{{truncateContent(item.content)}}</text>
      </view>
      <view class="item-footer" wx:if="{{item.result && item.result.score}}">
        <text class="score">è¯„åˆ†: {{item.result.score}}</text>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:if="{{history.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
  </view>

  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view class="footer-actions" wx:if="{{history.length > 0}}">
    <button class="clear-btn" bindtap="clearHistory" loading="{{clearing}}">æ¸…ç©ºå†å²</button>
  </view>
</view>
